import{u as M}from"./vue-router@4.1.6_vue@3.2.47-19dfbab8.js";import{M as L}from"./markdown-it@13.0.1-a6842a12.js";import{m as S}from"./@traptitech_markdown-it-katex@3.6.0-22314b6a.js";import{m as H}from"./markdown-it-link-attributes@4.0.1-93fca217.js";import{u as P,b as j}from"./@vueuse_core@9.13.0_vue@3.2.47-1b085bfa.js";import{t as y}from"./index-c2940f7d.js";import{d as _,L as D,f as k,H as m,I as N,y as O,M as v,N as f,O as z,h as G,b as w,J as U,n as T,j as R,o as V,D as J}from"./@vue_runtime-core@3.2.47-cef9f3df.js";import{J as C,n as g}from"./@vue_shared@3.2.47-27c997c3.js";import{w as u,k as x}from"./@vue_reactivity@3.2.47-7641be53.js";import{I as W}from"./@iconify_vue@4.1.0_vue@3.2.47-2c27d927.js";import{m as K}from"./naive-ui@2.34.3_vue@3.2.47-cb767681.js";import{a as F}from"./axios@1.3.4-aba6f0e0.js";import"./entities@3.0.1-170e234c.js";import"./uc.micro@1.0.6-740ead6f.js";import"./mdurl@1.0.1-79eba04e.js";import"./linkify-it@4.0.1-01ce85b0.js";import"./punycode@2.3.0-82137b55.js";import"./katex@0.16.4-02707d4e.js";import"./@vueuse_shared@9.13.0_vue@3.2.47-5b0ac903.js";import"./@vue_runtime-dom@3.2.47-75247773.js";import"./pinia@2.0.33_typescript@4.9.5_vue@3.2.47-570a8bde.js";import"./vue-demi@0.13.11_vue@3.2.47-71ba0ef2.js";import"./crypto-js@4.1.1-7eba5088.js";import"./vooks@0.2.12_vue@3.2.47-db3d0b5e.js";import"./evtd@0.2.4-b614532e.js";import"./vue-i18n@9.2.2_vue@3.2.47-c18290e3.js";import"./@intlify_shared@9.2.2-6f62a0ce.js";import"./@intlify_core-base@9.2.2-e46b7bcb.js";import"./@intlify_message-compiler@9.2.2-e451351e.js";import"./@intlify_devtools-if@9.2.2-c61c979f.js";import"./lodash-es@4.17.21-d880f9ca.js";import"./@emotion_hash@0.8.0-8a8e73f6.js";import"./vueuc@0.4.51_vue@3.2.47-5fd8b5c1.js";import"./seemly@0.3.6-50667136.js";import"./@css-render_vue3-ssr@0.15.12_vue@3.2.47-8d511426.js";import"./css-render@0.15.12-57b1a53f.js";import"./vdirs@0.1.8_vue@3.2.47-4519c5fd.js";import"./@juggle_resize-observer@3.4.0-41516555.js";import"./treemate@0.3.11-18296855.js";import"./@css-render_plugin-bem@0.15.12_css-render@0.15.12-9dde7ffe.js";const I=_({__name:"index",props:{icon:null},setup(e){const o=D(),t=k(()=>({class:o.class||"",style:o.style||""}));return(l,n)=>(m(),N(u(W),O({icon:e.icon},u(t)),null,16,["icon"]))}});function B(){return{isMobile:P(j).smaller("sm")}}const Q={key:0},X=["innerHTML"],Y=["textContent"],Z=["textContent"],q={key:2,class:"dark:text-white w-[4px] h-[20px] block animate-blink"},ee=_({__name:"Text",props:{inversion:{type:Boolean},error:{type:Boolean},text:null,loading:{type:Boolean},asRawText:{type:Boolean}},setup(e,{expose:o}){const t=e,{isMobile:l}=B(),n=x(),r=new L({html:!0,linkify:!0,highlight(c,s){if(!!(s&&hljs.getLanguage(s))){const h=s??"";return p(hljs.highlight(c,{language:h}).value,h)}return p(hljs.highlightAuto(c).value,"")}});r.use(H,{attrs:{target:"_blank",rel:"noopener"}}),r.use(S,{blockClass:"katexmath-block rounded-md p-[10px]",errorColor:" #cc0000"});const i=k(()=>["text-wrap","min-w-[20px]","rounded-md",l.value?"p-2":"px-3 py-2",t.inversion?"bg-[#d2f9d1]":"bg-[#f4f6f8]",t.inversion?"dark:bg-[#a1dc95]":"dark:bg-[#1e1e20]",t.inversion?"message-request":"message-reply",{"text-red-500":t.error}]),d=k(()=>{const c=t.text??"";return t.asRawText?c:r.render(c)});function p(c,s){return`<pre class="code-block-wrapper"><div class="code-block-header"><span class="code-block-header__lang">${s}</span><span class="code-block-header__copy">${y("chat.copyCode")}</span></div><code class="hljs code-block-body ${s}">${c}</code></pre>`}return o({textRef:n}),(c,s)=>(m(),v("div",{class:g(["text-black",u(i)])},[f("div",{ref_key:"textRef",ref:n,class:"leading-relaxed break-words"},[e.inversion?(m(),v("div",{key:1,class:"whitespace-pre-wrap",textContent:C(u(d))},null,8,Z)):(m(),v("div",Q,[e.asRawText?(m(),v("div",{key:1,class:"whitespace-pre-wrap",textContent:C(u(d))},null,8,Y)):(m(),v("div",{key:0,class:"markdown-body",innerHTML:u(d)},null,8,X))])),e.loading?(m(),v("text",q)):z("",!0)],512)],2))}});function A(e){const o={origin:!0,...e};let t;o.origin?t=document.createElement("textarea"):t=document.createElement("input"),t.setAttribute("readonly","readonly"),t.value=o.text,document.body.appendChild(t),t.select(),document.execCommand("copy")&&document.execCommand("copy"),document.body.removeChild(t)}const te=()=>({iconRender:o=>{const{color:t,fontSize:l,icon:n}=o,r={};return t&&(r.color=t),l&&(r.fontSize=`${l}px`),n||window.console.warn("iconRender: icon is required"),()=>G(I,{icon:n,style:r})}}),oe={class:"flex flex-col"},ne={class:"transition text-neutral-300 hover:text-neutral-800 dark:hover:text-neutral-200"},re=_({__name:"index",props:{dateTime:null,text:null,inversion:{type:Boolean},error:{type:Boolean},loading:{type:Boolean}},emits:["regenerate","delete"],setup(e,{emit:o}){const t=e,{isMobile:l}=B(),{iconRender:n}=te(),r=x(),i=x(t.inversion),d=x(),p=k(()=>{const s=[{label:y("chat.copy"),key:"copyText",icon:n({icon:"ri:file-copy-2-line"})}];return t.inversion||s.unshift({label:i.value?y("chat.preview"):y("chat.showRawText"),key:"toggleRenderType",icon:n({icon:i.value?"ic:outline-code-off":"ic:outline-code"})}),s});function c(s){switch(s){case"copyText":A({text:t.text??""});return;case"toggleRenderType":i.value=!i.value;return;case"delete":o("delete")}}return(s,a)=>(m(),v("div",{ref_key:"messageRef",ref:d,class:g(["flex w-full mb-6 overflow-hidden",[{"flex-row-reverse":e.inversion}]])},[f("div",{class:g(["overflow-hidden text-sm",[e.inversion?"items-end":"items-start"]])},[f("div",{class:g(["flex items-end gap-1 mt-2",[e.inversion?"flex-row-reverse":"flex-row"]])},[w(ee,{ref_key:"textRef",ref:r,inversion:e.inversion,error:e.error,text:e.text,loading:e.loading,"as-raw-text":i.value},null,8,["inversion","error","text","loading","as-raw-text"]),f("div",oe,[w(u(K),{trigger:u(l)?"click":"hover",placement:e.inversion?"left":"right",options:u(p),onSelect:c},{default:U(()=>[f("button",ne,[w(u(I),{icon:"ri:more-2-fill"})])]),_:1},8,["trigger","placement","options"])])],2)],2)],2))}});function se(){const e=x(null);return{scrollRef:e,scrollToBottom:async()=>{await T(),e.value&&(e.value.scrollTop=e.value.scrollHeight)},scrollToTop:async()=>{await T(),e.value&&(e.value.scrollTop=0)},scrollToBottomIfAtBottom:async()=>{await T(),e.value&&e.value.scrollHeight-e.value.scrollTop-e.value.clientHeight<=100&&(e.value.scrollTop=e.value.scrollHeight)}}}function le(){function e(){document.querySelectorAll(".code-block-wrapper").forEach(t=>{const l=t.querySelector(".code-block-header__copy"),n=t.querySelector(".code-block-body");l&&n&&l.addEventListener("click",()=>{var r;(r=navigator.clipboard)!=null&&r.writeText?navigator.clipboard.writeText(n.textContent??""):A({text:n.textContent??"",origin:!0})})})}R(()=>e()),V(()=>e())}const b=F.create({baseURL:"/"});b.interceptors.request.use(e=>e,e=>Promise.reject(e.response));b.interceptors.response.use(e=>{if(e.status===200)return e;throw new Error(e.status.toString())},e=>Promise.reject(e));function ie({url:e,data:o,method:t,headers:l,onDownloadProgress:n,signal:r,beforeRequest:i,afterRequest:d}){const p=a=>a.data,c=a=>{throw d==null||d(),new Error((a==null?void 0:a.message)||"Error")};i==null||i(),t=t||"GET";const s=Object.assign(typeof o=="function"?o():o??{},{});return t==="GET"?b.get(e,{params:s,signal:r,onDownloadProgress:n}).then(p,c):b.post(e,s,{headers:l,signal:r,onDownloadProgress:n}).then(p,c)}function ce({url:e,data:o,method:t="GET",onDownloadProgress:l,signal:n,beforeRequest:r,afterRequest:i}){return ie({url:e,method:t,data:o,onDownloadProgress:l,signal:n,beforeRequest:r,afterRequest:i})}function ae(e){return ce({url:`reply-stream?msgId=${e.msgId}`,onDownloadProgress:e.onDownloadProgress})}const de={class:"flex flex-col w-full h-full"},ue={class:"flex-1 overflow-hidden"},Ze=_({__name:"index",setup(e){let o=new AbortController;le();const{isMobile:t}=B(),{scrollRef:l,scrollToBottom:n}=se(),r=x(null),i=x(""),d=x(!1),p=x(!0),c=M();async function s(){o=new AbortController,n();try{await(async()=>{await ae({onDownloadProgress:({event:h})=>{const $=h.target,{responseText:E}=$;i.value=E},msgId:`${c.query.msgId}`})})()}catch{d.value=!0}finally{p.value=!1}}return s(),R(()=>{var a;n(),r.value&&!t.value&&((a=r.value)==null||a.focus())}),J(()=>{p.value&&o.abort()}),(a,h)=>(m(),v("div",de,[f("main",ue,[f("div",{id:"scrollRef",ref_key:"scrollRef",ref:l,class:"h-full overflow-hidden overflow-y-auto"},[f("div",{id:"image-wrapper",class:g([[u(t)?"p-2":"p-4"],"w-full max-w-screen-xl m-auto dark:bg-[#101014]"])},[f("div",null,[w(u(re),{error:d.value,loading:p.value,text:i.value},null,8,["error","loading","text"])])],2)],512)])]))}});export{Ze as default};
